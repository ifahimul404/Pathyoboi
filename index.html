<!DOCTYPE html>
<html lang="bn" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>সুরক্ষিত ই-লাইব্রেরি</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-out',
                        'slide-in': 'slideIn 0.3s ease-out',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        slideIn: {
                            '0%': { transform: 'translateX(-100%)' },
                            '100%': { transform: 'translateX(0)' },
                        }
                    }
                }
            }
        }
    </script>

    <!-- Phosphor Icons (Icons for UI) -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <style>
        /* Scrollbar Hide */
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        /* Prevent Selection */
        .no-select {
            user-select: none;
            -webkit-user-select: none;
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-colors duration-300 font-sans overflow-hidden selection:bg-blue-500 selection:text-white no-select">

    <!-- ================= HOME VIEW ================= -->
    <div id="home-view" class="flex h-screen w-full relative transition-opacity duration-300">
        
        <!-- Mobile Overlay -->
        <div id="sidebar-overlay" class="fixed inset-0 bg-black/60 z-30 hidden opacity-0 transition-opacity duration-300 md:hidden" onclick="toggleSidebar(false)"></div>

        <!-- Sidebar -->
        <aside id="sidebar" class="fixed inset-y-0 left-0 z-40 w-72 transform -translate-x-full md:translate-x-0 transition-transform duration-300 ease-in-out bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700 flex flex-col">
            <div class="p-6 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center">
                <h1 class="text-2xl font-bold flex items-center gap-2">
                    <i class="ph-fill ph-book-open-text text-blue-600"></i>
                    ই-লাইব্রেরি
                </h1>
                <button onclick="toggleSidebar(false)" class="md:hidden p-1 rounded hover:bg-gray-200 dark:hover:bg-gray-700">
                    <i class="ph ph-x text-xl"></i>
                </button>
            </div>

            <nav class="p-4 space-y-2 flex-1 overflow-y-auto" id="category-list">
                <!-- Categories generated by JS -->
            </nav>

            <div class="p-4 text-xs text-center border-t border-gray-200 dark:border-gray-700 text-gray-500">
                বাম দিকে সোয়াইপ করে মেনু বন্ধ করুন
            </div>
        </aside>

        <!-- Main Content -->
        <div class="flex-1 flex flex-col h-screen overflow-hidden relative z-0 md:ml-0 w-full">
            <!-- Header -->
            <header class="bg-white dark:bg-gray-800 shadow-sm px-6 py-4 flex justify-between items-center z-20 transition-colors duration-300">
                <button class="md:hidden p-2 -ml-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors" onclick="toggleSidebar(true)">
                    <i class="ph ph-list text-2xl text-gray-600 dark:text-gray-200"></i>
                </button>
                
                <div class="flex-1 max-w-xl mx-4 relative">
                    <i class="ph ph-magnifying-glass absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 text-lg"></i>
                    <input 
                        type="text" 
                        id="search-input"
                        placeholder="বই খুঁজুন..." 
                        class="w-full pl-10 pr-4 py-2 border rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors bg-gray-50 dark:bg-gray-700 border-gray-200 dark:border-gray-600 text-gray-900 dark:text-white placeholder-gray-400"
                        oninput="handleSearch(this.value)"
                    >
                </div>

                <button onclick="toggleDarkMode()" class="p-2 rounded-full transition-colors transform hover:scale-110 duration-200 bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-yellow-400 hover:bg-gray-200 dark:hover:bg-gray-600">
                    <i id="theme-icon" class="ph-fill ph-sun text-xl"></i>
                </button>
            </header>

            <!-- Books Grid -->
            <main class="flex-1 overflow-y-auto p-6 scrollbar-hide">
                <div class="mb-6">
                    <h2 id="category-title" class="text-xl font-semibold">জনপ্রিয় বইসমূহ</h2>
                    <p id="book-count" class="text-sm mt-1 text-gray-500 dark:text-gray-400">লোড হচ্ছে...</p>
                </div>

                <div id="books-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 pb-20">
                    <!-- Books injected by JS -->
                </div>
                
                <!-- Empty State -->
                <div id="empty-state" class="hidden flex-col items-center justify-center h-64 opacity-50">
                    <i class="ph ph-magnifying-glass text-5xl mb-4"></i>
                    <p>কোনো বই খুঁজে পাওয়া যায়নি।</p>
                </div>
            </main>
        </div>
    </div>

    <!-- ================= READER VIEW ================= -->
    <div id="reader-view" class="fixed inset-0 bg-gray-900 z-50 hidden flex-col h-screen w-full">
        
        <!-- Reader Header (Smart Hide/Show) -->
        <div id="reader-header" class="absolute top-0 left-0 right-0 z-20 transition-transform duration-300 translate-y-0">
            <div class="bg-gray-800/95 backdrop-blur text-white px-4 py-3 shadow-lg flex justify-between items-center border-b border-gray-700">
                
                <!-- Left: Back & Title -->
                <div class="flex items-center gap-3 overflow-hidden">
                    <button onclick="closeReader()" class="p-2 hover:bg-gray-700 rounded-full transition-colors">
                        <i class="ph ph-caret-left text-xl"></i>
                    </button>
                    <div class="truncate">
                        <h2 id="reader-title" class="font-semibold text-sm md:text-base truncate">বইয়ের নাম</h2>
                    </div>
                </div>

                <!-- Right: Controls -->
                <div class="flex items-center gap-2 md:gap-4">
                    <!-- TOC Dropdown -->
                    <div class="relative">
                        <button onclick="toggleToc()" class="flex items-center gap-2 bg-gray-700 hover:bg-gray-600 px-3 py-2 rounded-lg text-sm transition-colors">
                            <i class="ph ph-list-bullets text-lg"></i>
                            <span class="hidden sm:inline">সূচিপত্র</span>
                            <i id="toc-icon" class="ph ph-caret-down text-sm transition-transform duration-200"></i>
                        </button>

                        <!-- TOC Menu -->
                        <div id="toc-menu" class="absolute right-0 mt-2 w-64 bg-white dark:bg-gray-800 rounded-lg shadow-xl border border-gray-200 dark:border-gray-700 overflow-hidden z-50 max-h-[60vh] overflow-y-auto hidden">
                             <div class="p-3 bg-gray-100 dark:bg-gray-900 border-b dark:border-gray-700 font-semibold text-xs uppercase text-gray-500">
                               অধ্যায় নির্বাচন করুন
                             </div>
                             <div id="toc-list">
                                 <!-- Chapters injected by JS -->
                             </div>
                        </div>
                    </div>
                    
                    <!-- Full Screen Button -->
                    <button onclick="toggleFullScreen()" class="p-2 bg-gray-700 hover:bg-gray-600 rounded-lg text-white transition-colors" id="fs-btn">
                        <i id="fs-icon" class="ph ph-corners-out text-lg"></i>
                    </button>

                    <!-- Security Badge -->
                    <div class="hidden lg:flex items-center gap-2 text-yellow-500 text-xs bg-yellow-500/10 px-3 py-1 rounded-full border border-yellow-500/20">
                        <i class="ph-fill ph-shield-warning"></i>
                        <span>সুরক্ষিত</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- PDF Container -->
        <div class="flex-1 relative bg-gray-800 flex items-center justify-center pt-14 w-full h-full overflow-hidden"> 
            <div class="w-full h-full relative" oncontextmenu="return false;">
                <iframe 
                    id="pdf-iframe"
                    src=""
                    class="w-full h-full border-none bg-white"
                    title="PDF Viewer">
                </iframe>
                
                <!-- Watermark -->
                <div class="absolute inset-0 pointer-events-none flex items-center justify-center opacity-[0.03] z-10">
                    <p class="text-4xl md:text-6xl font-bold rotate-45 text-black dark:text-white select-none">Protected View</p>
                </div>
                
                <!-- Transparent Shield Layer (Prevents drag/drop) -->
                <div class="absolute inset-0 z-0 bg-transparent"></div>
            </div>
        </div>
    </div>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // --- DATA ---
        const books = [
            {
                id: 1,
                title: "প্রোগ্রামিং এর হাতেখড়ি",
                author: "জন ডো",
                category: "Technology",
                coverColor: "bg-blue-600",
                chapters: [
                    { title: "সূচনা", page: 1 },
                    { title: "অধ্যায় ১: ভেরিয়েবল", page: 2 },
                    { title: "অধ্যায় ২: লুপ", page: 3 },
                    { title: "উপসংহার", page: 4 }
                ],
                pdfUrl: "https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf"
            },
            {
                id: 2,
                title: "হিমু এবং এক বিকেলে",
                author: "হুমায়ূন আহমেদ",
                category: "Fiction",
                coverColor: "bg-yellow-600",
                chapters: [{ title: "শুরু", page: 1 }, { title: "শেষ", page: 2 }],
                pdfUrl: "https://pdfobject.com/pdf/sample.pdf"
            },
            {
                id: 3,
                title: "মহাকাশের অজানা কথা",
                author: "মহাকাশ গবেষক",
                category: "Science",
                coverColor: "bg-purple-700",
                chapters: [{ title: "ভূমিকা", page: 1 }],
                pdfUrl: "https://www.africau.edu/images/default/sample.pdf"
            },
            {
                id: 4,
                title: "জাভাস্ক্রিপ্ট শিখুন",
                author: "কোডার ভাই",
                category: "Technology",
                coverColor: "bg-green-700",
                chapters: [{ title: "JS কি?", page: 1 }],
                pdfUrl: "https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf"
            },
            {
                id: 5,
                title: "অপেক্ষা",
                author: "হুমায়ূন আহমেদ",
                category: "Fiction",
                coverColor: "bg-red-600",
                chapters: [{ title: "অধ্যায় ১", page: 1 }],
                pdfUrl: "https://pdfobject.com/pdf/sample.pdf"
            },
            {
                id: 6,
                title: "কোয়ান্টাম ফিজিক্স",
                author: "বিজ্ঞান ক্লাব",
                category: "Science",
                coverColor: "bg-indigo-700",
                chapters: [{ title: "পরমাণু", page: 1 }],
                pdfUrl: "https://www.africau.edu/images/default/sample.pdf"
            }
        ];

        const categories = ["All", "Fiction", "Technology", "Science"];
        
        // --- STATE VARIABLES ---
        let currentCategory = "All";
        let searchQuery = "";
        let currentBook = null;
        let isDarkMode = true;
        let isSidebarOpen = false;
        
        // --- DOM ELEMENTS ---
        const dom = {
            html: document.documentElement,
            homeView: document.getElementById('home-view'),
            readerView: document.getElementById('reader-view'),
            booksGrid: document.getElementById('books-grid'),
            categoryList: document.getElementById('category-list'),
            categoryTitle: document.getElementById('category-title'),
            bookCount: document.getElementById('book-count'),
            sidebar: document.getElementById('sidebar'),
            sidebarOverlay: document.getElementById('sidebar-overlay'),
            readerHeader: document.getElementById('reader-header'),
            readerTitle: document.getElementById('reader-title'),
            pdfIframe: document.getElementById('pdf-iframe'),
            tocMenu: document.getElementById('toc-menu'),
            tocList: document.getElementById('toc-list'),
            tocIcon: document.getElementById('toc-icon'),
            themeIcon: document.getElementById('theme-icon'),
            fsIcon: document.getElementById('fs-icon'),
            emptyState: document.getElementById('empty-state')
        };

        // --- INITIALIZATION ---
        function init() {
            renderCategories();
            renderBooks();
            setupSecurity();
            setupSwipe();
            updateThemeIcon();
        }

        // --- RENDER FUNCTIONS ---
        function renderCategories() {
            dom.categoryList.innerHTML = '';
            dom.categoryList.innerHTML = `<h2 class="text-xs font-semibold uppercase tracking-wider mb-4 ${isDarkMode ? 'text-gray-400' : 'text-gray-500'}">ক্যাটাগরি সমূহ</h2>`;
            
            categories.forEach(cat => {
                const btn = document.createElement('button');
                const isActive = currentCategory === cat;
                btn.className = `w-full text-left px-4 py-3 rounded-lg transition-all duration-200 mb-1 ${
                    isActive 
                    ? 'bg-blue-600 text-white font-medium shadow-md translate-x-1' 
                    : 'text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700'
                }`;
                btn.textContent = cat === 'All' ? 'সকল বই' : cat;
                btn.onclick = () => {
                    currentCategory = cat;
                    toggleSidebar(false);
                    renderCategories(); // Re-render to update active state
                    renderBooks();
                };
                dom.categoryList.appendChild(btn);
            });
        }

        function renderBooks() {
            dom.booksGrid.innerHTML = '';
            
            const filtered = books.filter(book => {
                const matchCat = currentCategory === "All" || book.category === currentCategory;
                const matchSearch = book.title.toLowerCase().includes(searchQuery.toLowerCase()) || 
                                    book.author.toLowerCase().includes(searchQuery.toLowerCase());
                return matchCat && matchSearch;
            });

            // Update Titles
            dom.categoryTitle.textContent = currentCategory === 'All' ? 'জনপ্রিয় বইসমূহ' : `${currentCategory} এর বইসমূহ`;
            dom.bookCount.textContent = `মোট ${filtered.length} টি বই পাওয়া গেছে`;

            if (filtered.length === 0) {
                dom.emptyState.classList.remove('hidden');
                dom.emptyState.classList.add('flex');
                return;
            } else {
                dom.emptyState.classList.add('hidden');
                dom.emptyState.classList.remove('flex');
            }

            filtered.forEach((book, index) => {
                const delay = index * 100;
                const card = document.createElement('div');
                card.className = `group rounded-xl shadow-sm hover:shadow-xl transition-all duration-300 transform hover:-translate-y-1 overflow-hidden border flex flex-col animate-fade-in bg-white dark:bg-gray-800 border-gray-100 dark:border-gray-700`;
                card.style.animationDelay = `${delay}ms`;
                
                card.innerHTML = `
                    <div class="h-48 w-full ${book.coverColor} flex items-center justify-center relative cursor-pointer overflow-hidden" onclick="openReader(${book.id})">
                        <div class="absolute inset-0 bg-black/10 group-hover:bg-black/0 transition-colors duration-300"></div>
                        <div class="w-32 h-40 bg-white/20 backdrop-blur-sm rounded shadow-lg flex flex-col items-center justify-center text-white border border-white/30 transform group-hover:scale-105 transition-transform duration-500">
                            <i class="ph-fill ph-book-open-text text-4xl opacity-90"></i>
                        </div>
                    </div>
                    <div class="p-4 flex-1 flex flex-col">
                        <span class="text-xs text-blue-500 font-semibold uppercase mb-1">${book.category}</span>
                        <h3 class="text-lg font-bold leading-tight mb-1 cursor-pointer hover:text-blue-500 transition-colors dark:text-gray-100" onclick="openReader(${book.id})">${book.title}</h3>
                        <p class="text-sm mb-4 text-gray-500 dark:text-gray-400">${book.author}</p>
                        <button onclick="openReader(${book.id})" class="mt-auto w-full py-2 rounded-lg transition-colors flex items-center justify-center gap-2 text-sm font-medium bg-gray-900 dark:bg-gray-700 hover:bg-gray-800 dark:hover:bg-blue-600 text-white">
                            <i class="ph ph-book-open-text text-lg"></i>
                            পড়তে শুরু করুন
                        </button>
                    </div>
                `;
                dom.booksGrid.appendChild(card);
            });
        }

        // --- ACTIONS ---
        function handleSearch(val) {
            searchQuery = val;
            renderBooks();
        }

        function toggleSidebar(show) {
            isSidebarOpen = show;
            if (show) {
                dom.sidebar.classList.remove('-translate-x-full');
                dom.sidebarOverlay.classList.remove('hidden');
                setTimeout(() => dom.sidebarOverlay.classList.remove('opacity-0'), 10); // fade in
            } else {
                dom.sidebar.classList.add('-translate-x-full');
                dom.sidebarOverlay.classList.add('opacity-0');
                setTimeout(() => dom.sidebarOverlay.classList.add('hidden'), 300); // wait for fade out
            }
        }

        function toggleDarkMode() {
            isDarkMode = !isDarkMode;
            if (isDarkMode) {
                dom.html.classList.add('dark');
            } else {
                dom.html.classList.remove('dark');
            }
            updateThemeIcon();
            renderCategories(); // to update hover classes if needed
        }

        function updateThemeIcon() {
            if (isDarkMode) {
                dom.themeIcon.classList.replace('ph-moon', 'ph-sun');
            } else {
                dom.themeIcon.classList.replace('ph-sun', 'ph-moon');
            }
        }

        // --- READER LOGIC ---
        function openReader(bookId) {
            const book = books.find(b => b.id === bookId);
            if (!book) return;
            
            currentBook = book;
            dom.readerTitle.textContent = book.title;
            
            // Setup TOC
            dom.tocList.innerHTML = '';
            book.chapters.forEach(chap => {
                const btn = document.createElement('button');
                btn.className = "w-full text-left px-4 py-3 hover:bg-gray-100 dark:hover:bg-gray-700 text-sm text-gray-800 dark:text-gray-200 border-b border-gray-100 dark:border-gray-700 last:border-0 flex justify-between";
                btn.innerHTML = `<span>${chap.title}</span><span class="text-xs text-gray-400 bg-gray-200 dark:bg-gray-900 px-2 py-0.5 rounded">P. ${chap.page}</span>`;
                btn.onclick = () => loadPdfPage(chap.page);
                dom.tocList.appendChild(btn);
            });

            // Load PDF
            loadPdfPage(1);

            // Switch View
            dom.homeView.classList.add('hidden');
            dom.readerView.classList.remove('hidden');
            dom.readerView.classList.add('flex');
        }

        function closeReader() {
            dom.pdfIframe.src = ""; // Stop loading
            dom.readerView.classList.add('hidden');
            dom.readerView.classList.remove('flex');
            dom.homeView.classList.remove('hidden');
            
            // Exit Fullscreen if active
            if (document.fullscreenElement) {
                document.exitFullscreen();
            }
        }

        function loadPdfPage(page) {
            if (!currentBook) return;
            // Security parameters: #toolbar=0&navpanes=0&scrollbar=0
            dom.pdfIframe.src = `${currentBook.pdfUrl}#page=${page}&toolbar=0&navpanes=0&scrollbar=0&view=FitH`;
            dom.tocMenu.classList.add('hidden'); // Close TOC
            dom.tocIcon.classList.remove('rotate-180');
        }

        function toggleToc() {
            const isHidden = dom.tocMenu.classList.contains('hidden');
            if (isHidden) {
                dom.tocMenu.classList.remove('hidden');
                dom.tocIcon.classList.add('rotate-180');
            } else {
                dom.tocMenu.classList.add('hidden');
                dom.tocIcon.classList.remove('rotate-180');
            }
        }

        function toggleFullScreen() {
            if (!document.fullscreenElement) {
                dom.readerView.requestFullscreen().catch(err => {
                    alert(`Error attempting to enable full-screen mode: ${err.message}`);
                });
            } else {
                document.exitFullscreen();
            }
        }

        // Update Fullscreen Icon
        document.addEventListener('fullscreenchange', () => {
            if (document.fullscreenElement) {
                dom.fsIcon.classList.replace('ph-corners-out', 'ph-corners-in');
            } else {
                dom.fsIcon.classList.replace('ph-corners-in', 'ph-corners-out');
            }
        });

        // Smart Header (Scroll/Wheel logic)
        dom.readerView.addEventListener('wheel', (e) => {
            if (e.deltaY > 0) {
                // Scroll Down -> Hide
                dom.readerHeader.classList.add('-translate-y-full');
                dom.tocMenu.classList.add('hidden'); // Also close TOC
            } else {
                // Scroll Up -> Show
                dom.readerHeader.classList.remove('-translate-y-full');
            }
        });

        // --- SWIPE LOGIC (Sidebar) ---
        let touchStartX = 0;
        let touchEndX = 0;

        function setupSwipe() {
            dom.sidebar.addEventListener('touchstart', e => {
                touchStartX = e.changedTouches[0].screenX;
            });

            dom.sidebar.addEventListener('touchend', e => {
                touchEndX = e.changedTouches[0].screenX;
                handleSwipe();
            });
        }

        function handleSwipe() {
            // Detect left swipe (close sidebar)
            if (touchStartX - touchEndX > 50) {
                toggleSidebar(false);
            }
        }

        // --- SECURITY ---
        function setupSecurity() {
            // Disable Right Click
            document.addEventListener('contextmenu', event => event.preventDefault());

            // Disable Shortcuts (Ctrl+S, Ctrl+P, F12)
            document.addEventListener('keydown', function(e) {
                if ((e.ctrlKey && (e.key === 'p' || e.key === 's' || e.key === 'u')) || e.key === 'F12') {
                    e.preventDefault();
                }
            });
        }

        // Run Init
        init();

    </script>
</body>
</html>

